{%- assign settings = section.settings -%}
{%- assign blocks = section.blocks -%}
{%- assign image = settings.image | img_url: '2160x' -%}
{%- assign image_intermediate = settings['image_intermediate'] | img_url: '1200x' -%}
{%- assign image_mobile = settings['image_mobile'] | img_url: '700x' -%}
{%- assign image_alt = image.alt -%}

{%- capture image_sources -%}
  {%- if image_mobile != blank -%}
    {{- image_mobile -}}
  {%- endif -%}
  {%- if image_intermediate != blank -%}
    |{{- image_intermediate -}}
  {%- endif -%}
  {%- if image != blank -%}
    |{{- image -}}
  {%- endif -%}
{%- endcapture  -%}

{%- capture breakpoints -%}
  {%- if image_mobile != blank -%}
    (max-width: 767px)
  {%- endif -%}
  {%- if image_intermediate != blank -%}
    |(max-width: 999px)
  {%- endif -%}
  {%- if image != blank -%}
    |(min-width: 1000px)
  {%- endif -%}
{%- endcapture  -%}

{%- capture additional_content -%}
{%- render 'icon-text-grid',
  items: blocks,
  grid_class: 'icon-text-grid--inline' -%}
{%- endcapture -%}

{%- if settings.enable_section -%}
  {%- render 'text-and-image' with settings['media_type'] as media_type,
    image_sources: image_sources,
    breakpoints: breakpoints,
    image_alt: image_alt,
    video: settings.video,
    video_s: settings.video_s,
    video_l: settings.video_l,
    fallback: image_mobile,
    fallback_s: image_intermediate,
    fallback_l: image,
    tagline: settings.tagline,
    title: settings.title,
    text: settings.text,
    cta_url: settings.cta_url,
    cta_text: settings.cta_text,
    content_alignment: settings.content_alignment,
    text_alignment: settings.text_alignment,
    additional_content: additional_content -%}
{%- endif -%}

{% schema %}
{
  "name": "Text and Image 2",
  "class": "text-and-image-section",
  "settings": [
    {
      "type": "checkbox",
      "id": "enable_section",
      "label": "Enable this Section",
      "default": true
    },
    {
      "type": "header",
      "content": "Media"
    },
    {
      "type": "select",
      "id": "media_type",
      "label": "Media Type",
      "options": [
        {
          "value": "image",
          "label": "Image"
        },
        {
          "value": "video",
          "label": "Video"
        },
        {
          "value": "none",
          "label": "None"
        }
      ],
      "default": "image"
    },
    {
      "type": "image_picker",
      "id": "image_mobile",
      "label": "Image (Mobile)",
      "info": "Upload a JPEG of ~ 700px."
    },
    {
      "type": "image_picker",
      "id": "image_intermediate",
      "label": "Image (Intermediate)",
      "info": "Upload a JPEG of ~ 1200px."
    },
    {
      "type": "image_picker",
      "id": "image",
      "label": "Image (Desktop)",
      "info": "Upload a JPEG of ~ 2160px."
    },
    {
      "type": "url",
      "id": "video",
      "label": "Video URL (Mobile)",
      "info": "MP4 url. E.g. MP4 link from Vimeo Pro."
    },
    {
      "type": "url",
      "id": "video_s",
      "label": "Video URL (Intermediate)",
      "info": "MP4 url. E.g. MP4 link from Vimeo Pro."
    },
    {
      "type": "url",
      "id": "video_l",
      "label": "Video URL (Desktop)",
      "info": "MP4 url. E.g. MP4 link from Vimeo Pro."
    },
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "text",
      "id": "tagline",
      "label": "Tagline (Optional)"
    },
    {
      "type": "text",
      "id": "title",
      "label": "Title"
    },
    {
      "type": "textarea",
      "id": "text",
      "label": "Text (Optional)"
    },
    {
      "type": "text",
      "id": "cta_text",
      "label": "CTA Text (Optional)"
    },
    {
      "type": "url",
      "id": "cta_url",
      "label": "CTA URL (Optional)"
    },
    {
      "type": "select",
      "id": "content_alignment",
      "label": "Content Alignment",
      "options": [
        {
          "value": "left",
          "label": "Left"
        },
        {
          "value": "right",
          "label": "Right"
        }
      ],
      "default": "left"
    },
    {
      "type": "select",
      "id": "text_alignment",
      "label": "Text Alignment",
      "options": [
        {
          "value": "left",
          "label": "Left"
        },
        {
          "value": "center",
          "label": "Center"
        }
      ],
      "default": "left"
    }
  ],
  "blocks": [
    {
      "type": "icon-text",
      "name": "Icon + Text",
      "limit": 4,
      "settings": [
        {
          "type": "textarea",
          "id": "text",
          "label": "Text"
        },
        {
          "type": "select",
          "id": "icon_type",
          "label": "Icon Type",
          "options": [
            {
              "value": "svg",
              "label": "SVG"
            },
            {
              "value": "jpeg-png",
              "label": "JPEG/PNG"
            }
          ],
          "default": "jpeg-png"
        },
        {
          "type": "text",
          "id": "icon_svg",
          "label": "Icon SVG",
          "info": "Enter SVG file name, should be uploaded in Settings/Files"
        },
        {
          "type": "image_picker",
          "id": "icon_jpeg_png",
          "label": "Icon JPEG/PNG"
        }
      ]
    }
  ]
}
{% endschema %}
