{%- layout false -%}
{% assign easylockdownItemSelectorOff = true %}
{%- paginate search.results by 10 -%}
  {
  "results": [
  {%- for item in search.results -%}{% comment %}EasylockdownFilterBegin{% endcomment %}{% capture easylockdownFilter %}{% render 'easylockdown_filter_search' with item, easylockdownRender: true, easylockdownItemSelectorOff: easylockdownItemSelectorOff %}{% endcapture %}{% assign easylockdownFilter = easylockdownFilter | strip %}{% if easylockdownFilter == 'continue' %}{% continue %}{% else %}{{ easylockdownFilter }}{% endif %}{% comment %}EasylockdownFilterEnd{% endcomment %}
    {%- if item.object_type == 'product' -%}
      {%- render 'product-json', item: item, encode: false -%}
    {%- else -%}
      {%- if item.object_type == 'article' -%}
        {%- capture tag  -%}
          {%- for tag in item.tags -%}
            {%- if tag contains 'category-' -%}
              {{- tag | replace: "category-", "" | replace: "-", " " -}}
              {%- break -%}
            {%- endif -%}
          {%- endfor -%}
        {%- endcapture -%}
      {%- endif -%}
      {%- if item.excerpt != blank -%}
        {%- assign excerpt = item.excerpt | strip_html | highlight: search.terms -%}
      {%- else -%}
        {%- assign excerpt = item.content | strip_html | truncatewords: 10, "..." | highlight: search.terms -%}
      {%- endif -%}
      {%- assign title = item.title | highlight: search.terms -%}
      {%- assign image =  item.image | img_url: '450x' -%}
      {%- assign image_alt =  item.image.alt -%}
      {
      "id": {{ item.id | json }},
      "type": {{ item.object_type | json }},
      "resultType": {{ item.object_type | json }},
      "title": {{ title | json }},
      "tag": {{ tag | json }},
      "url": {{ item.url | json }},
      "image": {{ image | json }},
      "image_alt": {{ image_alt | json }},
      "excerpt": {{ excerpt | json }}
      }
    {%- endif -%}{%- unless forloop.last -%},{%- endunless -%}
  {%- endfor -%}
  ],
  "totalResults": {{- search.results_count -}}
  }
{%- endpaginate -%}
